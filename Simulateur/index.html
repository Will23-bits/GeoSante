<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GeoSante - Grippe (ODiSSE SPF)</title>

  <!-- Leaflet & Heatmap -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

  <!-- DSFR minimal -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.12.2/dist/dsfr.min.css">
  <script type="module" src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.12.2/dist/dsfr.module.min.js"></script>

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="app-header fr-container">
    <h1>GeoSante - Grippe</h1>
    <div class="header-right">
      <span class="badge" id="status">Initialisation...</span>
    </div>
  </header>

  <main class="layout">
    <section class="left-panel">
      <div class="controls-row">
        <label for="weekSelect" class="label">Semaine</label>
        <select id="weekSelect" class="select"></select>
      </div>

      <div id="map"></div>

      <div class="legend">
        <span class="legend-label">Faible</span>
        <div class="legend-gradient"></div>
        <span class="legend-label">Critique</span>
      </div>
    </section>

    <aside class="right-panel">
      <div class="card">
        <h2>R&eacute;sum&eacute; national</h2>
        <div class="summary-grid">
          <div class="summary-item">
            <div class="summary-label">Population</div>
            <div class="summary-value" id="populationValue">68 000 000</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Infections estim&eacute;es</div>
            <div class="summary-value" id="infectionValue">--</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Incidence FR (/100k)</div>
            <div class="summary-value" id="incidenceFR">--</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Semaine</div>
            <div class="summary-value" id="weekLabel">--</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Score de risque</div>
            <div class="summary-value" id="riskScore">--</div>
          </div>
        </div>
        <div class="risk-section">
          <div class="risk-level">Niveau de risque : <span id="riskLevel">--</span></div>
          <div class="risk-bar">
            <div class="risk-progress" id="riskProgress"></div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Ressources &amp; mesures</h2>
        <div class="slider-group">
          <div class="slider-row">
            <div class="slider-meta">
              <label for="sliderDoctors" class="slider-label">Medecins</label>
              <span class="slider-value" id="sliderDoctorsValue">143 000</span>
            </div>
            <input type="range" id="sliderDoctors" class="slider" min="50000" max="220000" step="1000" value="143000" data-key="doctors">
          </div>
          <div class="slider-row">
            <div class="slider-meta">
              <label for="sliderNurses" class="slider-label">Infirmiers</label>
              <span class="slider-value" id="sliderNursesValue">60 000</span>
            </div>
            <input type="range" id="sliderNurses" class="slider" min="20000" max="562000" step="1000" value="60000" data-key="nurses">
          </div>
          <div class="slider-row">
            <div class="slider-meta">
              <label for="sliderStudents" class="slider-label">Etudiants</label>
              <span class="slider-value" id="sliderStudentsValue">8 000</span>
            </div>
            <input type="range" id="sliderStudents" class="slider" min="0" max="50000" step="500" value="8000" data-key="students">
          </div>
          <div class="slider-row">
            <div class="slider-meta">
              <label for="sliderVaccination" class="slider-label">Vaccination (%)</label>
              <span class="slider-value" id="sliderVaccinationValue">35 %</span>
            </div>
            <input type="range" id="sliderVaccination" class="slider" min="0" max="100" step="1" value="35" data-key="vaccination">
          </div>
          <div class="slider-row">
            <div class="slider-meta">
              <label for="sliderContacts" class="slider-label">R&eacute;duction des contacts (%)</label>
              <span class="slider-value" id="sliderContactsValue">0 %</span>
            </div>
            <input type="range" id="sliderContacts" class="slider" min="0" max="80" step="1" value="0" data-key="contacts">
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Ressources par r&eacute;gion</h2>
        <p class="small">R&eacute;partissez vos effectifs par r&eacute;gion (valeurs absolues en personnes). La somme ne peut pas d&eacute;passer le stock national.</p>
        <div class="region-summary" id="regionSummary"></div>
        <div id="regionControls" class="region-grid"></div>
      </div>

      <div class="card">
        <h2>Propagation</h2>
        <p class="small">Bas&eacute; sur R<sub>0</sub> = <span id="effectiveR0">1,6</span> et contagiosit&eacute; = 6 j (&#8776; 0,27/jour), att&eacute;nu&eacute; par ressources et contacts.</p>
        <div class="prop-grid">
          <div class="prop-item">
            <div class="prop-label">Nouvelles inf. (24 h)</div>
            <div class="prop-value" id="dailyInfections">--</div>
          </div>
          <div class="prop-item">
            <div class="prop-label">Total estim&eacute; j+7</div>
            <div class="prop-value" id="projection7d">--</div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Donn&eacute;es harmonis&eacute;es</h2>
        <ul class="small">
          <li>Filtrage : uniquement <strong>grippe / syndromes grippaux</strong>.</li>
          <li>Harmonisation : libell&eacute;s r&eacute;gions (accents), ISO-week, agr&eacute;gation r&eacute;gionale.</li>
          <li>Mesure : <strong>Incidence pour 100 000</strong> par r&eacute;gion.</li>
        </ul>
      </div>
    </aside>
  </main>

  <footer class="app-footer fr-container">
    <div>&copy; 2025 GeoSante - Source : ODiSSE Sant&eacute; publique France</div>
  </footer>

  <script src="app.js"></script>
</body>
</html>
